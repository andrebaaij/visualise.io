var socket=new easyXDM.Socket({onMessage:function(b,a){returnMessage={};b=JSON.parse(b);if(typeof b.source!=="undefined"&&typeof b.source.callback!=="undefined"){_vis.common.getFunctionFromString(b.source.callback)(b.body)}else{if(b.action==="load"){if(b.resource==="template"){_vis.template.load(b.body)}else{if(b.resource==="visualisation"){_vis.visualisation.load(b.body)}else{console.error="This message type("+b.action+" "+b.resource+") is not supported at "+a}}}else{if(b.action==="update"){if(b.resource==="template"){_vis.template.update(b.body)}else{if(b.resource==="visualisation"){_vis.visualisation.update(b.body)}else{console.error="This message type("+b.action+" "+b.resource+") is not supported at "+a}}}else{if(b.action==="get"){if(b.resource==="definition"){returnMessage=_vis.definition.get()}else{console.error="This message type("+b.action+" "+b.resource+") is not supported at "+a}}else{if(b.action==="resize"&&b.resource==="window"){_vis.common.resize(b.body)}else{console.error="This message type("+b.action+" "+b.resource+") is not supported at "+a}}}}}if(typeof b.callback!=="undefined"){returnMessage.action="response";returnMessage.source=b;socket.postMessage(JSON.stringify(returnMessage))}}});_vis={datasets:{data:{data:""}},menu:{id:"menu",panels:[],element:{}},visualisation:{id:1,parameters:{}},template:{id:1},common:{settings:{}},definition:{}};_vis.common.resize=function(a){_vis.menu.height=a.height;$(".menu-content").css("height",a.height);$("visualisation").css("height",a.height)};_vis.common.isNumber=function isNumber(a){return !isNaN(parseFloat(a))&&isFinite(a)};_vis.common.escape=function escape(b){
/*!
	The function _vis.common.escape is under the following copyright:

	<copyright>
		Copyright Mathias Bynens <http://mathiasbynens.be/>

		Permission is hereby granted, free of charge, to any person obtaining
		a copy of this software and associated documentation files (the
		"Software"), to deal in the Software without restriction, including
		without limitation the rights to use, copy, modify, merge, publish,
		distribute, sublicense, and/or sell copies of the Software, and to
		permit persons to whom the Software is furnished to do so, subject to
		the following conditions:

		The above copyright notice and this permission notice shall be
		included in all copies or substantial portions of the Software.

		THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
		EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
		MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
		NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
		LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
		OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
		WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
	</copyright>
	<source>
		https://github.com/mathiasbynens/jsesc
	</source>
	*/
;jsCache={"\b":"\\b","\t":"\\t","\n":"\\n","\v":"\\x0b","\f":"\\f","\r":"\\r",'"':'\\"',"\u2028":"\\u2028","\u2029":"\\u2029","'":"\\'","\\":"\\\\"};function c(h,g){var m=h.charAt(0),f="",d=0,e=h.length,l,j,n,k=0,o;while(d<e){j=h.charAt(d++);n=j.charCodeAt();if(g&&(n<32||n>126)){if((n&63488)==55296){k++;o=h.charCodeAt(d++);if((n&64512)!=55296||(o&64512)!=56320){throw Error("UCS-2(decode): illegal sequence")}n=((n&1023)<<10)+(o&1023)+65536}l="\\"+n.toString(16)+" "}else{if(/[\t\n\v\f:]/.test(j)){l="\\"+n.toString(16)+" "}else{if(/[ !"#$%&'()*+,./;<=>?@\[\\\]^`{|}~]/.test(j)){l="\\"+j}else{l=j}}}f+=l}if(/^_/.test(f)){f="\\_"+f.slice(1)}if(/^-[-\d]/.test(f)){f="\\-"+f.slice(1)}if(/\d/.test(m)){f="\\3"+m+" "+f.slice(1)}return{surrogatePairCount:k,output:f}}function a(d){return d.replace(/[\s\S]/g,function(j){var e=j.charCodeAt(),f=e.toString(16),g=f.length>2,h;if(/[\x20-\x26\x28-\x5b\x5d-\x7e]/.test(j)){return j}if(jsCache[j]){return jsCache[j]}h=jsCache[j]="\\"+(g?"u":"x")+("0000"+f).slice(g?-4:-2);return h})}return c(b.replace(/\r\n?/g,"\n"),true).output};_vis.common.getFunctionFromString=function(b){var c=window;var a=b.split(".");for(i=0;i<a.length-1;i++){c=c[a[i]];if(c==undefined){return}}return c[a[a.length-1]]};_vis.common.settings.update=function updateSetting(a,b){message={action:"update",resource:"setting",body:{settings:[]}};message.body.settings.push(a);message.body[a]=b;socket.postMessage(JSON.stringify(message))};_vis.datasets.data.getHeaders=function getHeaders(a){return a.split("\n")[0].split(",")};_vis.datasets.data.getNumericHeaders=function getNumericHeaders(c){var b=c.split("\n")[0].split(","),a=[];$.each(b,function(d,e){if(c.split("\n").length===0||_vis.common.isNumber(c.split("\n")[1].split(",")[d])){a.push(e)}});return a};_vis.datasets.data.getColumnValuesByHeader=function getColumnValuesByHeader(a){values=[];columnHeaders=_vis.datasets.data.data.split("\n")[0].split(",");columnIndex=-1;$.each(columnHeaders,function(b,c){if(c===a){columnIndex=b}});if(columnIndex>=0){$.each(this.data.split("\n"),function(b,c){if(b>0){columnValue=c.split(",")[columnIndex];if($.inArray(columnValue,values)==-1){values.push(columnValue)}}})}return values};_vis.datasets.data.update=function update(){if(typeof _vis.datasets.data.data==="undefined"||_vis.datasets.data.data===null){_vis.datasets.data.headers=[];_vis.datasets.data.numericHeaders=[]}else{_vis.datasets.data.headers=_vis.datasets.data.getHeaders(_vis.datasets.data.data);_vis.datasets.data.numericHeaders=_vis.datasets.data.getNumericHeaders(_vis.datasets.data.data)}};_vis.menu.addPanel=function addPanel(b,a){panel=_vis.menu.element.panel(b,a);_vis.menu.panels.push(panel);return panel};_vis.menu.toDOM=function toDOM(){$defaultDOM=$('<div class="col-lg-12 menu-content"></div>').css("height",_vis.menu.height);$.each(this.panels,function(b,a){$defaultDOM.append(a.toDOM(a))});return $defaultDOM};_vis.menu.element.input=function input(f){oInput={type:"input",id:f,input:true,eventListeners:[],value:null};oInput.addEventListener=function d(h,g){oInput.eventListeners.push({event:h,handler:g})};oInput.val=function e(g){if(typeof g==="undefined"){return this.value}else{this.value=g}};oInput.setLabel=function b(g){this.label=g};oInput.setPlaceholder=function a(g){this.placeholder=g};oInput.toDOM=function c(g){$defaultInputDOM=$('<div class="form-group"><div id="inputType"><div id="input" class="input-group"><input type="text" class="form-control" id="value" /></div></div></div>');if(typeof g.label!=="undefined"){$defaultInputDOM.find("#inputType").prepend($('<div id="label" class="col-lg-2 control-label" for="input_value"></div>').text(g.label));$defaultInputDOM.find("#input").addClass("col-lg-10").find("#value").val(g.value).attr("id",g.id).attr("placeholder",this.placeholder)}else{$defaultInputDOM.find("#input").addClass("col-lg-12").find("#value").val(g.value).attr("id",g.id).attr("placeholder",this.placeholder)}return $defaultInputDOM};return oInput};_vis.menu.element.select=function select(e){oSelect={type:"select",id:e,input:true,value:null,options:[]};oSelect.val=function d(f){if(typeof f==="undefined"){return this.value}else{this.value=f}};oSelect.setLabel=function b(f){this.label=f};oSelect.addOption=function a(h,f){option={value:h,label:f};option.toDOM=function g(k,j){$defaultOptionDOM=$("<option></option>");$defaultOptionDOM.attr("value",k.value);$defaultOptionDOM.text(k.label);if(j){$defaultOptionDOM.attr("selected",true)}return $defaultOptionDOM};oSelect.options.push(option);return option};oSelect.toDOM=function c(f){$defaultInputDOM=$('<div class="form-group"><div id="inputType"><div id="label" class="col-lg-2 control-label" for="input_value"></div><div id="input" class="col-lg-10 input-group"><select id="value" class="form-control"></select></div></div></div>');$defaultInputDOM.find("#label").text(f.label);$defaultInputDOM.find("#value").attr("id",f.id);$.each(f.options,function(g,h){$defaultInputDOM.find("select").append(h.toDOM(h,h.value===f.value?true:false))});return $defaultInputDOM};return oSelect};_vis.menu.element.textarea=function textarea(e){oTextarea={type:"textarea",id:e,input:true,value:null};oTextarea.val=function d(f){if(typeof f==="undefined"){return this.value}else{this.value=f}};oTextarea.setLabel=function b(f){this.label=f};oTextarea.setPlaceholder=function a(f){this.placeholder=f};oTextarea.toDOM=function c(f){$defaultInputDOM=$('<div class="form-group"><div id="inputType"><div id="label" class="col-lg-2 control-label" for="input_value"></div><div id="input" class="col-lg-10 input-group"><textarea type="text" class="form-control" id="value"></textarea></div></div></div>');$defaultInputDOM.find("#label").text(f.label);$defaultInputDOM.find("#value").attr("id",f.id).val(f.value);return $defaultInputDOM};return oTextarea};_vis.menu.element.panel=function addPanel(d,c){panel={id:d,heading:c,groups:[],input:false,type:"panel"};panel.toDOM=function a(e){$defaultPanelDOM=$('<div class="panel form-horizontal"></div>');$panelHeadingDOM=$('<div class="panel-heading">'+this.heading+"</div>");$panelHeadingDOM.on("click",function(){$(this).parent().find(".group").toggle()});$defaultPanelDOM.append($panelHeadingDOM).attr("id",this.id);$.each(e.groups,function(f,g){$defaultPanelDOM.append(g.toDOM(g))});return $defaultPanelDOM};panel.addGroup=function b(e){group=_vis.menu.element.group(e);this.groups.push(group);return group};return panel};_vis.menu.element.slider=function slider(f,b,a,e){if(typeof e==="undefined"){e=(a-b)/100}oSlider={id:f,input:true,type:"slider",value:null,label:null,min:b,max:a,step:e};oSlider.setLabel=function c(g){this.label=g};oSlider.toDOM=function d(g){$sliderDOM=$('<div class="form-group"><div id="inputType"><div id="input" class="col-lg-10 input-group slider"></div></div></div>');$labelDOM=$('<div id="label" class="col-lg-2 control-label" for="input_value"></div>').text(g.label);if(g.label!==null){$sliderDOM.prepend($labelDOM)}$inputDOM=$('<input type="text" data-slider-min="'+g.min+'" data-slider-max="'+g.max+'" data-slider-step="'+g.step+'" data-slider-value="'+g.value+'"/>').attr("id",g.id);$sliderDOM.find("#input").append($inputDOM);return $sliderDOM};return oSlider};_vis.menu.element.colorpicker=function colorpicker(c){oColorpicker={id:c,input:true,type:"colorpicker",value:null,label:null};oColorpicker.setLabel=function a(d){this.label=d};oColorpicker.toDOM=function b(d){$colorpickerDOM=$('<div class="form-group"><div id="inputType"><div id="input" class="col-lg-10 input-group"></div></div></div>');$labelDOM=$('<div id="label" class="col-lg-2 control-label" for="input_value"></div>').text(d.label);if(d.label!==null){$colorpickerDOM.prepend($labelDOM)}$inputDOM=$('<div id="'+d.id+'" class="circle"></div>').css("background-color",d.value);$colorpickerDOM.find("#input").append($inputDOM);$defaultInputDOM.find("#value").attr("id",input.id).val(input.value);return $colorpickerDOM};return oColorpicker};_vis.menu.element.group=function addGroup(c){group={id:c,label:null,elements:[],input:false,type:"group"};group.setLabel=function f(k){this.label=k};group.toDOM=function j(k){$defaultInputGroupDOM=$('<div class="group"></div>').attr("id",k.id);if(typeof k.label!=="undefined"&&k.label!==null&&k.label.length>0){$defaultInputGroupLabelDOM=$("<label></label>");$defaultInputGroupDOM.append($defaultInputGroupLabelDOM.text(k.label))}$.each(k.elements,function(l,m){$defaultInputGroupDOM.append(m.toDOM(m))});return $defaultInputGroupDOM};group.addInput=function a(k){input=_vis.menu.element.input(k);this.elements.push(input);return input};group.addSelect=function b(k){select=_vis.menu.element.select(k);this.elements.push(select);return select};group.addTextarea=function h(k){textarea=_vis.menu.element.textarea(k);this.elements.push(textarea);return textarea};group.addTable=function e(k){table=_vis.menu.element.table(k);this.elements.push(table);return table};group.addColorpicker=function d(k){colorpicker=_vis.menu.element.colorpicker(k);this.elements.push(colorpicker);return colorpicker};group.addSlider=function g(n,l,k,m){slider=_vis.menu.element.slider(n,l,k,m);this.elements.push(slider);return slider};return group};_vis.menu.element.table=function table(b){oTable={id:b,rows:[],headers:[],input:false,type:"table"};oTable.setHeaders=function(d,c){this.headers=[d,c]};oTable.addRow=function(e,d){row={col1:e,col2:d};row.toDOM=function c(f,g){$defaultRowDOM=$('<tr><td id="1" class="table-label"><span></span></td><td id="2"></td></tr>');$defaultRowDOM.attr("id",f);$defaultRowDOM.find("td#1 span").text(g.col1);if(g.col2.constructor===String){$defaultRowDOM.find("td#2").text(g.col2)}else{if(g.col2.constructor===Object&&g.col2.input===true){$defaultRowDOM.find("td#2").append(g.col2.toDOM(g.col2))}}return $defaultRowDOM};this.rows.push(row);return row};oTable.toDOM=function a(c){$defaultTableInputDOM=$('<table id="table" class="table form-horizontal"><thead><tr></tr></thead><tbody></tbody></table>').attr("id",c.id);if(c.headers.length>0){$defaultTableInputDOM.find("thead tr").append('<th class="col-lg-2" style="text-align:right">'+c.headers[0]+"</th>");$defaultTableInputDOM.find("thead tr").append('<th class="col-lg-10">'+c.headers[1]+"</th>")}$.each(c.rows,function(d,e){$defaultTableInputDOM.find("tbody").append(e.toDOM(d,e))});return $defaultTableInputDOM};return oTable};_vis.template.load=function load(body){_vis.datasets.data.data=body.data;_vis.visualisation.parameters=body.parameters;_vis.template.definition=body.javascript;_vis.datasets.data.update();_vis.menu.initialise();try{eval(_vis.template.definition)}catch(e){alert("Parsing the javascript definition throws error(s)!");console.log(e)}_vis.visualisation.parse();_vis.menu.height=body.height;$(".menu-content").css("height",body.height);$("visualisation").css("height",body.height)};_vis.menu.initialise=function initialise(){_vis.menu.panels=[];panel_configuration=_vis.menu.addPanel("configuration","Settings");group_onfiguration=panel_configuration.addGroup("visualisation");input_name=group_onfiguration.addInput("name");input_name.setLabel("Name");textarea_description=group_onfiguration.addTextarea("description");textarea_description.setLabel("Desc")};_vis.visualisation.load=function load(a){_vis.datasets.data.data=a.data;_vis.visualisation.parameters=a.parameters;_vis.datasets.data.update();_vis.visualisation.parse();$(".menu-content").css("height",a.height);$("visualisation").css("height",a.height)};_vis.visualisation.parse=function parse(){_vis.menu.draw();_vis.visualisation.draw()};_vis.definition.get=function get(a){returnMessage={body:{parameters:_vis.visualisation.parameters,DOM:_vis.visualisation.DOM.html(),draw:String(_vis.visualisation.definition)}};return returnMessage};_vis.menu.draw=function draw(){$.each(_vis.menu.panels,function(index_panel,panel){if(typeof _vis.visualisation.parameters[_vis.common.escape(panel.id)]==="undefined"){_vis.visualisation.parameters[_vis.common.escape(panel.id)]={}}$.each(panel.groups,function(index_group,group){if(typeof _vis.visualisation.parameters[_vis.common.escape(panel.id)][_vis.common.escape(group.id)]==="undefined"){_vis.visualisation.parameters[_vis.common.escape(panel.id)][_vis.common.escape(group.id)]={}}$.each(group.elements,function(index_element,element){if(element.input===true){if(typeof _vis.visualisation.parameters[_vis.common.escape(panel.id)][_vis.common.escape(group.id)][_vis.common.escape(element.id)]!=="undefined"){element.value=_vis.visualisation.parameters[_vis.common.escape(panel.id)][_vis.common.escape(group.id)][_vis.common.escape(element.id)];if(element.type==="select"){optionExists=false;$.each(element.options,function(index,option){if(element.value===option.value){optionExists=true}});if(optionExists===false){if(element.options.length>0){element.value=element.options[0].value;_vis.visualisation.parameters[_vis.common.escape(panel.id)][_vis.common.escape(group.id)][_vis.common.escape(element.id)]=element.options[0].value}else{element.value=null;_vis.visualisation.parameters[_vis.common.escape(panel.id)][_vis.common.escape(group.id)][_vis.common.escape(element.id)]=null}}}}}if(element.type==="table"){if(typeof _vis.visualisation.parameters[_vis.common.escape(panel.id)][_vis.common.escape(group.id)][_vis.common.escape(element.id)]==="undefined"){_vis.visualisation.parameters[_vis.common.escape(panel.id)][_vis.common.escape(group.id)][_vis.common.escape(element.id)]={}}$.each(element.rows,function(index_row,row){if(row.col2.input===true){if(typeof _vis.visualisation.parameters[_vis.common.escape(panel.id)][_vis.common.escape(group.id)][_vis.common.escape(element.id)][_vis.common.escape(row.col2.id)]!=="undefined"){row.col2.value=_vis.visualisation.parameters[_vis.common.escape(panel.id)][_vis.common.escape(group.id)][_vis.common.escape(element.id)][_vis.common.escape(row.col2.id)]}}})}})})});$("#menu").empty().append(_vis.menu.toDOM());$.each(_vis.menu.panels,function(index_panel,panel){$.each(panel.groups,function(index_group,group){$.each(group.elements,function(index_element,element){if(element.input===true){identifier="#menu #"+_vis.common.escape(panel.id)+" #"+_vis.common.escape(group.id)+" #input #"+_vis.common.escape(element.id);if(element.type==="colorpicker"){$(identifier+".circle").ColorPicker({color:_vis.visualisation.parameters[_vis.common.escape(panel.id)][_vis.common.escape(group.id)][_vis.common.escape(element.id)],onShow:function(colpkr){$(colpkr).fadeIn(500);return false},onHide:function(colpkr){$(colpkr).fadeOut(500);_vis.visualisation.parse();_vis.common.settings.update("objectHasChanges",true);return false},onChange:function(hsb,hex,rgb){$(this).css("backgroundColor","#"+hex);_vis.visualisation.parameters[_vis.common.escape(panel.id)][_vis.common.escape(group.id)][_vis.common.escape(element.id)]="#"+hex}})}else{if(element.type==="slider"){$(identifier).slider().on("slideStop",function(ev){_vis.visualisation.parameters[_vis.common.escape(panel.id)][_vis.common.escape(group.id)][_vis.common.escape(element.id)]=$(this).data("slider").getValue();_vis.visualisation.parse();_vis.common.settings.update("objectHasChanges",true)})}else{$(identifier).change(function(){val=$(this).val();_vis.visualisation.parameters[_vis.common.escape(panel.id)][_vis.common.escape(group.id)][_vis.common.escape(element.id)]=val;element.value=val;_vis.menu.initialise();try{eval(_vis.template.definition)}catch(e){console.log(e);alert("Parsing the javascript definition throws error(s)!")}_vis.visualisation.parse();_vis.common.settings.update("objectHasChanges",true)})}}}if(element.type==="table"){$.each(element.rows,function(index_row,row){if(row.col2.input===true){identifier="#menu #"+_vis.common.escape(panel.id)+" #"+_vis.common.escape(group.id)+" #"+_vis.common.escape(element.id)+" #"+_vis.common.escape(row.col2.id);if(row.col2.type==="colorpicker"){if(typeof _vis.visualisation.parameters[_vis.common.escape(panel.id)][_vis.common.escape(group.id)][_vis.common.escape(element.id)][_vis.common.escape(row.col2.id)]!=="undefined"){color=_vis.visualisation.parameters[_vis.common.escape(panel.id)][_vis.common.escape(group.id)][_vis.common.escape(element.id)][_vis.common.escape(row.col2.id)].substring(1,7)}else{color="cccccc"}$(identifier+".circle").ColorPicker({color:color,onShow:function(colpkr){$(colpkr).fadeIn(500);return false},onHide:function(colpkr){$(colpkr).fadeOut(500);_vis.visualisation.parse();_vis.common.settings.update("objectHasChanges",true);return false},onChange:function(hsb,hex,rgb){$(this).css("backgroundColor","#"+hex);_vis.visualisation.parameters[_vis.common.escape(panel.id)][_vis.common.escape(group.id)][_vis.common.escape(element.id)][_vis.common.escape(row.col2.id)]="#"+hex}})}else{if(element.type==="slider"){$(identifier).slider().on("slideStop",function(ev){_vis.visualisation.parameters[_vis.common.escape(panel.id)][_vis.common.escape(group.id)][_vis.common.escape(element.id)][_vis.common.escape(row.col2.id)]=$(this).data("slider").getValue();_vis.visualisation.parse();_vis.common.settings.update("objectHasChanges",true)})}else{$(identifier).on("change",function(){val=$(this).val();row.col2.value=val;_vis.visualisation.parameters[_vis.common.escape(panel.id)][_vis.common.escape(group.id)][_vis.common.escape(element.id)][_vis.common.escape(row.col2.id)]=val;_vis.menu.initialise();try{eval(_vis.template.definition)}catch(e){console.log(e);alert("Parsing the javascript definition throws error(s)!")}_vis.visualisation.parse();_vis.common.settings.update("objectHasChanges",true)})}}}})}})})})};_vis.visualisation.draw=function draw(a){if(typeof a!=="undefined"){_vis.visualisation.definition=a}if(typeof _vis.visualisation.definition!=="undefined"){try{_vis.visualisation.DOM=d3.select("visualisation");_vis.visualisation.DOM.html(null);_vis.visualisation.definition(_vis.visualisation.DOM,_vis.visualisation.parameters,_vis.datasets)}catch(b){console.log(b);alert("The draw function throws error(s)!")}}};_vis.template.update=function update(body){_vis.template.definition=body.javascript;_vis.datasets.data.update();_vis.menu.initialise();try{eval(_vis.template.definition)}catch(e){console.log(e);alert("Parsing the javascript definition throws error(s)!")}_vis.visualisation.parse()};_vis.visualisation.update=function update(body){_vis.datasets.data.data=body.data;_vis.datasets.data.update();_vis.menu.initialise();try{eval(_vis.template.definition)}catch(e){console.log(e);alert("Parsing the javascript definition throws error(s)!")}_vis.visualisation.parse()};