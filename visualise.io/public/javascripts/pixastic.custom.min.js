/*!
 * Pixastic - JavaScript Image Processing Library
 * Copyright (c) 2008 Jacob Seidelin, jseidelin@nihilogic.dk, http://blog.nihilogic.dk/
 * MIT License [http://www.pixastic.com/lib/license.txt]
 */
;var Pixastic=(function(){function d(m,n,l){if(m.addEventListener){m.addEventListener(n,l,false)}else{if(m.attachEvent){m.attachEvent("on"+n,l)}}}function g(n){var l=false;var o=function(){if(!l){l=true;n()}};document.write('<script defer src="//:" id="__onload_ie_pixastic__"><\/script>');var m=document.getElementById("__onload_ie_pixastic__");m.onreadystatechange=function(){if(m.readyState=="complete"){m.parentNode.removeChild(m);o()}};if(document.addEventListener){document.addEventListener("DOMContentLoaded",o,false)}d(window,"load",o)}function k(){var l=c("pixastic",null,"img");var o=c("pixastic",null,"canvas");var n=l.concat(o);for(var m=0;m<n.length;m++){(function(){var q=n[m];var s=[];var r=q.className.split(" ");for(var v=0;v<r.length;v++){var x=r[v];if(x.substring(0,9)=="pixastic-"){var u=x.substring(9);if(u!=""){s.push(u)}}}if(s.length){if(q.tagName.toLowerCase()=="img"){var p=new Image();p.src=q.src;if(p.complete){for(var w=0;w<s.length;w++){var t=Pixastic.applyAction(q,q,s[w],null);if(t){q=t}}}else{p.onload=function(){for(var y=0;y<s.length;y++){var z=Pixastic.applyAction(q,q,s[y],null);if(z){q=z}}}}}else{setTimeout(function(){for(var y=0;y<s.length;y++){var z=Pixastic.applyAction(q,q,s[y],null);if(z){q=z}}},1)}}})()}}if(typeof pixastic_parseonload!="undefined"&&pixastic_parseonload){g(k)}function c(r,p,l){var o=new Array();if(p==null){p=document}if(l==null){l="*"}var n=p.getElementsByTagName(l);var m=n.length;var q=new RegExp("(^|\\s)"+r+"(\\s|$)");for(i=0,j=0;i<m;i++){if(q.test(n[i].className)){o[j]=n[i];j++}}return o}var e;function a(m,n){if(!Pixastic.debug){return}try{switch(n){case"warn":console.warn("Pixastic:",m);break;case"error":console.error("Pixastic:",m);break;default:console.log("Pixastic:",m)}}catch(l){}if(!e){}}var b=(function(){var n=document.createElement("canvas");var m=false;try{m=!!((typeof n.getContext=="function")&&n.getContext("2d"))}catch(l){}return function(){return m}})();var f=(function(){var o=document.createElement("canvas");var n=false;var l;try{if(typeof o.getContext=="function"&&(l=o.getContext("2d"))){n=(typeof l.getImageData=="function")}}catch(m){}return function(){return n}})();var h=(function(){var n=false;var p=document.createElement("canvas");if(b()&&f()){p.width=p.height=1;var o=p.getContext("2d");o.fillStyle="rgb(255,0,0)";o.fillRect(0,0,1,1);var l=document.createElement("canvas");l.width=l.height=1;var q=l.getContext("2d");q.fillStyle="rgb(0,0,255)";q.fillRect(0,0,1,1);o.globalAlpha=0.5;o.drawImage(l,0,0);var m=o.getImageData(0,0,1,1).data;n=(m[2]!=255)}return function(){return n}})();return{parseOnLoad:false,debug:false,applyAction:function(E,p,o,n){n=n||{};var r=(E.tagName.toLowerCase()=="canvas");if(r&&Pixastic.Client.isIE()){if(Pixastic.debug){a("Tried to process a canvas element but browser is IE.")}return false}var m,v;var u=false;if(Pixastic.Client.hasCanvas()){u=!!n.resultCanvas;m=n.resultCanvas||document.createElement("canvas");v=m.getContext("2d")}var t=E.offsetWidth;var x=E.offsetHeight;if(r){t=E.width;x=E.height}if(t==0||x==0){if(E.parentNode==null){var s=E.style.position;var C=E.style.left;E.style.position="absolute";E.style.left="-9999px";document.body.appendChild(E);t=E.offsetWidth;x=E.offsetHeight;document.body.removeChild(E);E.style.position=s;E.style.left=C}else{if(Pixastic.debug){a("Image has 0 width and/or height.")}return}}if(o.indexOf("(")>-1){var A=o;o=A.substr(0,A.indexOf("("));var q=A.match(/\((.*?)\)/);if(q[1]){q=q[1].split(";");for(var B=0;B<q.length;B++){thisArg=q[B].split("=");if(thisArg.length==2){if(thisArg[0]=="rect"){var l=thisArg[1].split(",");n[thisArg[0]]={left:parseInt(l[0],10)||0,top:parseInt(l[1],10)||0,width:parseInt(l[2],10)||0,height:parseInt(l[3],10)||0}}else{n[thisArg[0]]=thisArg[1]}}}}}if(!n.rect){n.rect={left:0,top:0,width:t,height:x}}else{n.rect.left=Math.round(n.rect.left);n.rect.top=Math.round(n.rect.top);n.rect.width=Math.round(n.rect.width);n.rect.height=Math.round(n.rect.height)}var y=false;if(Pixastic.Actions[o]&&typeof Pixastic.Actions[o].process=="function"){y=true}if(!y){if(Pixastic.debug){a('Invalid action "'+o+'". Maybe file not included?')}return false}if(!Pixastic.Actions[o].checkSupport()){if(Pixastic.debug){a('Action "'+o+'" not supported by this browser.')}return false}if(Pixastic.Client.hasCanvas()){if(m!==E){m.width=t;m.height=x}if(!u){m.style.width=t+"px";m.style.height=x+"px"}v.drawImage(p,0,0,t,x);if(!E.__pixastic_org_image){m.__pixastic_org_image=E;m.__pixastic_org_width=t;m.__pixastic_org_height=x}else{m.__pixastic_org_image=E.__pixastic_org_image;m.__pixastic_org_width=E.__pixastic_org_width;m.__pixastic_org_height=E.__pixastic_org_height}}else{if(Pixastic.Client.isIE()&&typeof E.__pixastic_org_style=="undefined"){E.__pixastic_org_style=E.style.cssText}}var z={image:E,canvas:m,width:t,height:x,useData:true,options:n};var D=Pixastic.Actions[o].process(z);if(!D){return false}if(Pixastic.Client.hasCanvas()){if(z.useData){if(Pixastic.Client.hasCanvasImageData()){m.getContext("2d").putImageData(z.canvasData,n.rect.left,n.rect.top);m.getContext("2d").fillRect(0,0,0,0)}}if(!n.leaveDOM){m.title=E.title;m.imgsrc=E.imgsrc;if(!r){m.alt=E.alt}if(!r){m.imgsrc=E.src}m.className=E.className;m.style.cssText=E.style.cssText;m.name=E.name;m.tabIndex=E.tabIndex;m.id=E.id;if(E.parentNode&&E.parentNode.replaceChild){E.parentNode.replaceChild(m,E)}}n.resultCanvas=m;return m}return E},prepareData:function(q,m){var l=q.canvas.getContext("2d");var o=q.options.rect;var n=l.getImageData(o.left,o.top,o.width,o.height);var p=n.data;if(!m){q.canvasData=n}return p},process:function(m,l,n,q){if(m.tagName.toLowerCase()=="img"){var p=new Image();p.src=m.src;if(p.complete){var o=Pixastic.applyAction(m,p,l,n);if(q){q(o)}return o}else{p.onload=function(){var r=Pixastic.applyAction(m,p,l,n);if(q){q(r)}}}}if(m.tagName.toLowerCase()=="canvas"){var o=Pixastic.applyAction(m,m,l,n);if(q){q(o)}return o}},revert:function(l){if(Pixastic.Client.hasCanvas()){if(l.tagName.toLowerCase()=="canvas"&&l.__pixastic_org_image){l.width=l.__pixastic_org_width;l.height=l.__pixastic_org_height;l.getContext("2d").drawImage(l.__pixastic_org_image,0,0);if(l.parentNode&&l.parentNode.replaceChild){l.parentNode.replaceChild(l.__pixastic_org_image,l)}return l}}else{if(Pixastic.Client.isIE()){if(typeof l.__pixastic_org_style!="undefined"){l.style.cssText=l.__pixastic_org_style}}}},Client:{hasCanvas:b,hasCanvasImageData:f,hasGlobalAlpha:h,isIE:function(){return !!document.all&&!!window.attachEvent&&!window.opera}},Actions:{}}})();Pixastic.Actions.crop={process:function(f){if(Pixastic.Client.hasCanvas()){var c=f.options.rect;var b=c.width;var a=c.height;var e=c.top;var d=c.left;if(typeof f.options.left!="undefined"){d=parseInt(f.options.left,10)}if(typeof f.options.top!="undefined"){e=parseInt(f.options.top,10)}if(typeof f.options.height!="undefined"){b=parseInt(f.options.width,10)}if(typeof f.options.height!="undefined"){a=parseInt(f.options.height,10)}if(d<0){d=0}if(d>f.width-1){d=f.width-1}if(e<0){e=0}if(e>f.height-1){e=f.height-1}if(b<1){b=1}if(d+b>f.width){b=f.width-d}if(a<1){a=1}if(e+a>f.height){a=f.height-e}var g=document.createElement("canvas");g.width=f.width;g.height=f.height;g.getContext("2d").drawImage(f.canvas,0,0);f.canvas.width=b;f.canvas.height=a;f.canvas.getContext("2d").clearRect(0,0,b,a);f.canvas.getContext("2d").drawImage(g,d,e,b,a,0,0,b,a);f.useData=false;return true}},checkSupport:function(){return Pixastic.Client.hasCanvas()}};