/*!
 *
 * Color picker
 * Author: Stefan Petre www.eyecon.ro
 * 
 * Dual licensed under the MIT and GPL licenses
 * 
 */
(function(c){var d=function(){var a={},ad,V=65,av,aF='<div class="colorpicker"><div class="colorpicker_color"><div><div></div></div></div><div class="colorpicker_hue"><div></div></div><div class="colorpicker_new_color"></div><div class="colorpicker_current_color"></div><div class="colorpicker_hex"><input type="text" maxlength="6" size="6" /></div><div class="colorpicker_rgb_r colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgb_g colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgb_b colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_h colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_s colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_b colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_submit"></div></div>',am={eventName:"click",onShow:function(){},onBeforeShow:function(){},onHide:function(){},onChange:function(){},onSubmit:function(){},color:"ff0000",livePreview:true,flat:false},ae=function(g,e){var f=az(g);c(e).data("colorpicker").fields.eq(1).val(f.r).end().eq(2).val(f.g).end().eq(3).val(f.b).end()},au=function(f,e){c(e).data("colorpicker").fields.eq(4).val(f.h).end().eq(5).val(f.s).end().eq(6).val(f.b).end()},aE=function(f,e){c(e).data("colorpicker").fields.eq(0).val(b(f)).end()},aa=function(f,e){c(e).data("colorpicker").selector.css("backgroundColor","#"+b({h:f.h,s:100,b:100}));c(e).data("colorpicker").selectorIndic.css({left:parseInt(150*f.s/100,10),top:parseInt(150*(100-f.b)/100,10)})},ah=function(f,e){c(e).data("colorpicker").hue.css("top",parseInt(150-150*f.h/360,10))},aC=function(f,e){c(e).data("colorpicker").currentColor.css("backgroundColor","#"+b(f))},aj=function(f,e){c(e).data("colorpicker").newColor.css("backgroundColor","#"+b(f))},W=function(g){var e=g.charCode||g.keyCode||-1;if((e>V&&e<=90)||e==32){return false}var f=c(this).parent().parent();if(f.data("colorpicker").livePreview===true){aI.apply(this)}},aI=function(f){var e=c(this).parent().parent(),g;if(this.parentNode.className.indexOf("_hex")>0){e.data("colorpicker").color=g=Y(ap(this.value))}else{if(this.parentNode.className.indexOf("_hsb")>0){e.data("colorpicker").color=g=aG({h:parseInt(e.data("colorpicker").fields.eq(4).val(),10),s:parseInt(e.data("colorpicker").fields.eq(5).val(),10),b:parseInt(e.data("colorpicker").fields.eq(6).val(),10)})}else{e.data("colorpicker").color=g=aB(X({r:parseInt(e.data("colorpicker").fields.eq(1).val(),10),g:parseInt(e.data("colorpicker").fields.eq(2).val(),10),b:parseInt(e.data("colorpicker").fields.eq(3).val(),10)}))}}if(f){ae(g,e.get(0));aE(g,e.get(0));au(g,e.get(0))}aa(g,e.get(0));ah(g,e.get(0));aj(g,e.get(0));e.data("colorpicker").onChange.apply(e,[g,b(g),az(g)])},U=function(f){var e=c(this).parent().parent();e.data("colorpicker").fields.parent().removeClass("colorpicker_focus")},ab=function(){V=this.parentNode.className.indexOf("_hex")>0?70:65;c(this).parent().parent().data("colorpicker").fields.parent().removeClass("colorpicker_focus");c(this).parent().addClass("colorpicker_focus")},af=function(g){var e=c(this).parent().find("input").focus();var f={el:c(this).parent().addClass("colorpicker_slider"),max:this.parentNode.className.indexOf("_hsb_h")>0?360:(this.parentNode.className.indexOf("_hsb")>0?100:255),y:g.pageY,field:e,val:parseInt(e.val(),10),preview:c(this).parent().parent().data("colorpicker").livePreview};c(document).bind("mouseup",f,ax);c(document).bind("mousemove",f,Z)},Z=function(e){e.data.field.val(Math.max(0,Math.min(e.data.max,parseInt(e.data.val+e.pageY-e.data.y,10))));if(e.data.preview){aI.apply(e.data.field.get(0),[true])}return false},ax=function(e){aI.apply(e.data.field.get(0),[true]);e.data.el.removeClass("colorpicker_slider").find("input").focus();c(document).unbind("mouseup",ax);c(document).unbind("mousemove",Z);return false},ar=function(f){var e={cal:c(this).parent(),y:c(this).offset().top};e.preview=e.cal.data("colorpicker").livePreview;c(document).bind("mouseup",e,ay);c(document).bind("mousemove",e,aw)},aw=function(e){aI.apply(e.data.cal.data("colorpicker").fields.eq(4).val(parseInt(360*(150-Math.max(0,Math.min(150,(e.pageY-e.data.y))))/150,10)).get(0),[e.data.preview]);return false},ay=function(e){ae(e.data.cal.data("colorpicker").color,e.data.cal.get(0));aE(e.data.cal.data("colorpicker").color,e.data.cal.get(0));c(document).unbind("mouseup",ay);c(document).unbind("mousemove",aw);return false},aq=function(f){var e={cal:c(this).parent(),pos:c(this).offset()};e.preview=e.cal.data("colorpicker").livePreview;c(document).bind("mouseup",e,an);c(document).bind("mousemove",e,aD)},aD=function(e){aI.apply(e.data.cal.data("colorpicker").fields.eq(6).val(parseInt(100*(150-Math.max(0,Math.min(150,(e.pageY-e.data.pos.top))))/150,10)).end().eq(5).val(parseInt(100*(Math.max(0,Math.min(150,(e.pageX-e.data.pos.left))))/150,10)).get(0),[e.data.preview]);return false},an=function(e){ae(e.data.cal.data("colorpicker").color,e.data.cal.get(0));aE(e.data.cal.data("colorpicker").color,e.data.cal.get(0));c(document).unbind("mouseup",an);c(document).unbind("mousemove",aD);return false},at=function(e){c(this).addClass("colorpicker_focus")},aA=function(e){c(this).removeClass("colorpicker_focus")},aH=function(f){var e=c(this).parent();var g=e.data("colorpicker").color;e.data("colorpicker").origColor=g;aC(g,e.get(0));e.data("colorpicker").onSubmit(g,b(g),az(g),e.data("colorpicker").el)},ak=function(j){var f=c("#"+c(this).data("colorpickerId"));f.data("colorpicker").onBeforeShow.apply(this,[f.get(0)]);var e=c(this).offset();var g=ao();var h=e.top+this.offsetHeight;var i=e.left;if(h+176>g.t+g.h){h-=this.offsetHeight+176}if(i+356>g.l+g.w){i-=356}f.css({left:i+"px",top:h+"px"});if(f.data("colorpicker").onShow.apply(this,[f.get(0)])!=false){f.show()}c(document).bind("mousedown",{cal:f},T);return false},T=function(e){if(!ag(e.data.cal.get(0),e.target,e.data.cal.get(0))){if(e.data.cal.data("colorpicker").onHide.apply(this,[e.data.cal.get(0)])!=false){e.data.cal.hide()}c(document).unbind("mousedown",T)}},ag=function(f,g,h){if(f==g){return true}if(f.contains){return f.contains(g)}if(f.compareDocumentPosition){return !!(f.compareDocumentPosition(g)&16)}var e=g.parentNode;while(e&&e!=h){if(e==f){return true}e=e.parentNode}return false},ao=function(){var e=document.compatMode=="CSS1Compat";return{l:window.pageXOffset||(e?document.documentElement.scrollLeft:document.body.scrollLeft),t:window.pageYOffset||(e?document.documentElement.scrollTop:document.body.scrollTop),w:window.innerWidth||(e?document.documentElement.clientWidth:document.body.clientWidth),h:window.innerHeight||(e?document.documentElement.clientHeight:document.body.clientHeight)}},aG=function(e){return{h:Math.min(360,Math.max(0,e.h)),s:Math.min(100,Math.max(0,e.s)),b:Math.min(100,Math.max(0,e.b))}},X=function(e){return{r:Math.min(255,Math.max(0,e.r)),g:Math.min(255,Math.max(0,e.g)),b:Math.min(255,Math.max(0,e.b))}},ap=function(f){var h=6-f.length;if(h>0){var e=[];for(var g=0;g<h;g++){e.push("0")}e.push(f);f=e.join("")}return f},ac=function(e){var e=parseInt(((e.indexOf("#")>-1)?e.substring(1):e),16);return{r:e>>16,g:(e&65280)>>8,b:(e&255)}},Y=function(e){return aB(ac(e))},aB=function(i){var e={h:0,s:0,b:0};var h=Math.min(i.r,i.g,i.b);var f=Math.max(i.r,i.g,i.b);var g=f-h;e.b=f;if(f!=0){}e.s=f!=0?255*g/f:0;if(e.s!=0){if(i.r==f){e.h=(i.g-i.b)/g}else{if(i.g==f){e.h=2+(i.b-i.r)/g}else{e.h=4+(i.r-i.g)/g}}}else{e.h=-1}e.h*=60;if(e.h<0){e.h+=360}e.s*=100/255;e.b*=100/255;return e},az=function(h){var f={};var j=Math.round(h.h);var k=Math.round(h.s*255/100);var g=Math.round(h.b*255/100);if(k==0){f.r=f.g=f.b=g}else{var i=g;var l=(255-k)*g/255;var e=(i-l)*(j%60)/60;if(j==360){j=0}if(j<60){f.r=i;f.b=l;f.g=l+e}else{if(j<120){f.g=i;f.b=l;f.r=i-e}else{if(j<180){f.g=i;f.r=l;f.b=l+e}else{if(j<240){f.b=i;f.r=l;f.g=i-e}else{if(j<300){f.b=i;f.g=l;f.r=l+e}else{if(j<360){f.r=i;f.g=l;f.b=i-e}else{f.r=0;f.g=0;f.b=0}}}}}}}return{r:Math.round(f.r),g:Math.round(f.g),b:Math.round(f.b)}},al=function(f){var e=[f.r.toString(16),f.g.toString(16),f.b.toString(16)];c.each(e,function(h,g){if(g.length==1){e[h]="0"+g}});return e.join("")},b=function(e){return al(az(e))},ai=function(){var e=c(this).parent();var f=e.data("colorpicker").origColor;e.data("colorpicker").color=f;ae(f,e.get(0));aE(f,e.get(0));au(f,e.get(0));aa(f,e.get(0));ah(f,e.get(0));aj(f,e.get(0))};return{init:function(e){e=c.extend({},am,e||{});if(typeof e.color=="string"){e.color=Y(e.color)}else{if(e.color.r!=undefined&&e.color.g!=undefined&&e.color.b!=undefined){e.color=aB(e.color)}else{if(e.color.h!=undefined&&e.color.s!=undefined&&e.color.b!=undefined){e.color=aG(e.color)}else{return this}}}return this.each(function(){if(!c(this).data("colorpickerId")){var h=c.extend({},e);h.origColor=e.color;var f="collorpicker_"+parseInt(Math.random()*1000);c(this).data("colorpickerId",f);var g=c(aF).attr("id",f);if(h.flat){g.appendTo(this).show()}else{g.appendTo(document.body)}h.fields=g.find("input").bind("keyup",W).bind("change",aI).bind("blur",U).bind("focus",ab);g.find("span").bind("mousedown",af).end().find(">div.colorpicker_current_color").bind("click",ai);h.selector=g.find("div.colorpicker_color").bind("mousedown",aq);h.selectorIndic=h.selector.find("div div");h.el=this;h.hue=g.find("div.colorpicker_hue div");g.find("div.colorpicker_hue").bind("mousedown",ar);h.newColor=g.find("div.colorpicker_new_color");h.currentColor=g.find("div.colorpicker_current_color");g.data("colorpicker",h);g.find("div.colorpicker_submit").bind("mouseenter",at).bind("mouseleave",aA).bind("click",aH);ae(h.color,g.get(0));au(h.color,g.get(0));aE(h.color,g.get(0));ah(h.color,g.get(0));aa(h.color,g.get(0));aC(h.color,g.get(0));aj(h.color,g.get(0));if(h.flat){g.css({position:"relative",display:"block"})}else{c(this).bind(h.eventName,ak)}}})},showPicker:function(){return this.each(function(){if(c(this).data("colorpickerId")){ak.apply(this)}})},hidePicker:function(){return this.each(function(){if(c(this).data("colorpickerId")){c("#"+c(this).data("colorpickerId")).hide()}})},setColor:function(e){if(typeof e=="string"){e=Y(e)}else{if(e.r!=undefined&&e.g!=undefined&&e.b!=undefined){e=aB(e)}else{if(e.h!=undefined&&e.s!=undefined&&e.b!=undefined){e=aG(e)}else{return this}}}return this.each(function(){if(c(this).data("colorpickerId")){var f=c("#"+c(this).data("colorpickerId"));f.data("colorpicker").color=e;f.data("colorpicker").origColor=e;ae(e,f.get(0));au(e,f.get(0));aE(e,f.get(0));ah(e,f.get(0));aa(e,f.get(0));aC(e,f.get(0));aj(e,f.get(0))}})}}}();c.fn.extend({ColorPicker:d.init,ColorPickerHide:d.hidePicker,ColorPickerShow:d.showPicker,ColorPickerSetColor:d.setColor})})(jQuery);